<%- include('./partials/header.ejs') %>
  <body class="min-h-screen bg-fixed bg-center bg-no-repeat bg-cover" style="background-image: url('/assets/registerBG.jpg');">
    
    <div class="flex items-center justify-center h-screen ">
        <div class="p-10 rounded-lg shadow-lg bg-white/30 backdrop-blur-sm">

          <form action="" id="registerForm" >
            <div class="relative h-10 mb-10">
              <label for="email" class="text-orange-200 top-1">email</label>
              <input type="text" name="email" id="email" class="w-full h-full rounded-md bg-slate-300 " />
            </div>
            <div class="relative h-10 mb-10">
              <label for="password" class="text-orange-200 top-1">Password</label>
              <input type="password" name="password" id="password" class="w-full h-full rounded-md bg-slate-300 " />
            </div>
            
            <div class="text-center">
              <button type="submit" class="p-2 bg-orange-500 rounded-md bg-opacity-40 text-sky-200 hover:bg-black">Login</button>
            </div>
            
          </form>
        </div>
      
    </div>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script src="/js/validation.js"></script>
    <script>
      var notyf = new Notyf();
    </script>
    <script>
      const form = document.getElementById("registerForm");

      form.addEventListener("submit", (event) => {
        event.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        console.log(password)
        const validationError=[checkValidPassword(password,password),checkValidEmail(email) ]
        validationError.forEach((error)=>{
          if(error) notyf.error(error);
        })

        if(validationError.some((err)=>err !== undefined)){
          return;
        }
        
        loginUser(email,password)
      });

      const loginUser = async (
        email,
        password,
      ) => {
        try {
          const res=await fetch('/login',{
            method:"POST",
            body:JSON.stringify({email,password}),
            headers:{
              "content-type":"application/json"
            }
          })

          const resData=await res.json();
          
          if(resData.success){
            window.location.href=resData.redirectUrl
          }else{
            notyf.error(resData.message);
          }
          
        } catch (err) {
          console.log(err);
        }
      };
    </script>
  </body>
</html>
